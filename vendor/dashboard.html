<script type="module">
  import { auth } from "../firebase.js";
  import { onAuthStateChanged } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const db = getFirestore();

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "/vendor/login.html";
      return;
    }

    const snap = await getDoc(doc(db, "users", user.uid));

    if (!snap.exists() || snap.data().role !== "vendor") {
      alert("Unauthorized");
      window.location.href = "/vendor/login.html";
    }
  });
</script>
